# Patron API Flow

Description of the patron API flow.

## 1. Browsing the food categories

Patrons browse through the available food categories.

### Request

The client sends an HTTP request to get the list of available dishes.

`curl -X GET "https://bug-free-garbanzo-q7ppv44rjgw7399pg-80.app.github.dev/dishes"`.

### Response

If the request was successful, the server responds with a `200` status code with the response body containing the fields `description`, `category`, `price` and a list of incredients.

Example:

```JSON
{
            "id": "687e2e8949e4c43816685023",
            "created_at": "2025-03-19T02:41:05.794Z",
            "updated_at": "2025-07-21T10:35:21.639Z",
            "name": "Bruschetta al Pomodoro",
            "description": "Toasted bread topped with a mixture of ripe tomatoes, garlic, basil, and olive oil.",
            "category": "Appetizer",
            "preparation_time": 25,
            "price": 999,
            "image_name": "bruschetta_al_pomodoro",
            "station": "cold",
            "ingredients": [
                {
                    "ingredient_id": "687e2e8949e4c43816684ff4",
                    "is_essential": false,
                    "_id": "687e2e8949e4c43816685024"
                },
                {
                    "ingredient_id": "687e2e8949e4c43816685018",
                    "is_essential": true,
                    "_id": "687e2e8949e4c43816685025"
                },
                {
                    "ingredient_id": "687e2e8949e4c4381668501c",
                    "is_essential": true,
                    "_id": "687e2e8949e4c43816685026"
                }
            ]
        }
```

## 2. Checking the ingredient quantities

The client app must check inventory for necessary ingredients before displaying dishes in the UI. Each dish references ingredient IDs, identifying essential ones. If an essential ingredient is out of stock, the UI will disable dish selection.

### Request

The client sends an HTTP request to verify ingredient quantities at the designated endpoint:

`curl -X 'GET' \\
'https://bug-free-garbanzo-q7ppv44rjgw7399pg-80.app.github.dev/ingredients/' \\
-H 'accept: application/json'`

### Response

If the request was successful, the server responds with a `200` status code with the response body containing the field `in_stock_qty`. If any essential ingredients are out of stock, the client does not display the respective dish in the navigation.

Example:

```json
{

    "results": [

        {

            "id": "687e2e8949e4c43816684fed",

            "created_at": "2024-10-19T17:24:48.913Z",

            "updated_at": "2025-07-20T19:43:12.021Z",

            "name": "Gorgonzola Cheese",

            "price": 299,

            "in_stock_qty": 87

        },
```

## 3. Viewing dish details

Of all the available dishes that are being displayed, a patron now selects a dish from the list to look at the details.

### Request

The client sends an HTTP request to display the dish details at the designated endpoint, filtering the response to only the fields it needs to display on the dishâ€™s details page.:

`curl -X 'GET' \\
'{https://bug-free-garbanzo-q7ppv44rjgw7399pg-80.app.github.dev/dishes/{id}?fields=name%7Cprice%7Cimage_name%7Cingredients' \\
-H 'accept: application/json'`

### Response

If the request was successful, the server responds with a `200` status code with the response body containing the fields `name`, `price`, `image_name` and `ingredients`.

Example

```json
{
    "id": "687e2e8949e4c43816685023",
    "name": "Bruschetta al Pomodoro",
    "price": 999,
    "image_name": "bruschetta_al_pomodoro",
    "ingredients": [
        {
            "ingredient_id": "687e2e8949e4c43816684ff4",
            "is_essential": false,
            "_id": "687e2e8949e4c43816685024"
        },
        {
            "ingredient_id": "687e2e8949e4c43816685018",
            "is_essential": true,
            "_id": "687e2e8949e4c43816685025"
        },
        {
            "ingredient_id": "687e2e8949e4c4381668501c",
            "is_essential": true,
            "_id": "687e2e8949e4c43816685026"
        }
    ]
}
```

## 4. Adding dishes and viewing the cart

The patron can add any of the available dishes into their cart. Available dishes are displayed in a list on the main page. If a patron wants to add a dish to their cart, they use the **Add** button that is displayed in the list next to the dish name. Once all dishes are added, the patron can use the **Cart** icon on the top of the page to view the cart and check the contents.

## 5. Placing the order

Once they have selected all dishes, the patron can proceed to placing the order.

### Request

The client sends an HTTP request to place the order at the designated endpoint. It includes the name of the patron, the `table_number`, all `dish_ids` and any `special_requests`.

\``` url -X 'POST' \   'https://bug-free-garbanzo-q7ppv44rjgw7399pg-80.app.github.dev/orders' \   -H 'accept: application/json' \   -H 'Authorization: Bearer a1732455-42cf-4d24-a956-84adc847c0ca' \   -H 'Content-Type: application/json' \   -d '{   "name": "Ben",   "table_number": 18,   "dish_ids": [     "692a4a34a46ecf001f35ac6f",     "6a4a857c022eb7001f9b8972",     "6b7c2441a0db43001f9bf377"   ],   "special_requests": "No peanuts.",   "scheduled at": null }'` ``

### Response

If the request was successful, the server responds with a `201` status code with the response body confirming the fields in the request and additionally containing the fields `created_at`, `updated_at`, as well as the status of the request, for example `Received`.

Example:

```json
{
  "id": "674d0bf5c28b69001f8e03a1",
  "created_at": "2024-04-22T10:00:00Z",
  "updated_at": "2024-04-22T10:00:00Z",
  "name": "John",
  "table_number": 8,
  "dish_ids": [
    "692a4a34a46ecf001f35ac6f",
    "6a4a857c022eb7001f9b8972",
    "6b7c2441a0db43001f9bf377"
  ],
  "special_requests": "string",
  "priority": 3,
  "scheduled_at": null,
  "status": "Received"
}
```

## 6. Order confirmation

The server responds with the status `Received`once the order was places successfully. The UI displays a success message and the patron receives an e-mail notification confiming the order with the order details.